<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>Smart Home Control (MQTT)</title>
      <link rel="stylesheet" href="style.css" />
      <!-- MQTT.js (browser version) -->
      <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
   </head>
   <body data-theme="light">
      <div class="connection-indicator disconnected" id="connectionStatus">‚óè Disconnected</div>

      <!-- Login Page -->
      <div id="loginPage">
         <div class="login-container">
            <div class="login-box fade-in">
               <div class="login-header">
                  <h1>üè† Smart Home</h1>
                  <p>Sign in to access your controls</p>
               </div>
               <form id="loginForm">
                  <div class="form-group">
                     <label class="form-label">Username</label>
                     <input
                        type="text"
                        id="username"
                        class="form-input"
                        placeholder="Enter username"
                        required
                     />
                  </div>
                  <div class="form-group">
                     <label class="form-label">Password</label>
                     <input
                        type="password"
                        id="password"
                        class="form-input"
                        placeholder="Enter password"
                        required
                     />
                  </div>
                  <div class="form-checkbox">
                     <input type="checkbox" id="rememberMe" />
                     <label for="rememberMe">Remember Me</label>
                  </div>
                  <button
                     type="submit"
                     class="btn btn-primary"
                     id="loginBtn"
                     style="width: 100%; justify-content: center"
                  >
                     üîí Sign In
                  </button>
                  <div id="loginError" class="error-message"></div>
                  <div id="loginWarning" class="warning-message"></div>
               </form>
            </div>
         </div>
      </div>

      <!-- Main Dashboard -->
      <div id="mainPage" class="hidden">
         <div class="container">
            <header class="header fade-in">
               <div class="logo">
                  <div class="logo-icon">üè†</div>
                  <div class="logo-text">Smart Home Control</div>
               </div>
               <div class="header-controls">
                  <div class="theme-toggle">
                     <button class="theme-toggle-btn active" onclick="setTheme('light')">
                        ‚òÄÔ∏è Light
                     </button>
                     <button class="theme-toggle-btn" onclick="setTheme('dark')">üåô Dark</button>
                  </div>
                  <button class="btn btn-secondary" onclick="showChangePassword()">
                     ‚öôÔ∏è Change Credentials
                  </button>
                  <button class="btn btn-danger" onclick="logout()">üö™ Logout</button>
               </div>
            </header>

            <!-- Temperature Alert Banner -->
            <div class="alert-banner" id="alertBanner">
               <div class="alert-icon">üö®</div>
               <div class="alert-text">
                  <h3>Temperature Alert!</h3>
                  <p id="alertMessage">Temperature has exceeded the safe threshold</p>
               </div>
            </div>

            <!-- Sensor Data Display -->
            <div class="sensor-bar fade-in">
               <div class="sensor-grid">
                  <div class="sensor-card">
                     <div class="sensor-icon temperature">üå°Ô∏è</div>
                     <div class="sensor-data">
                        <h3>Temperature</h3>
                        <div>
                           <span class="sensor-value" id="temperatureValue">--</span>
                           <span class="sensor-unit">¬∞C</span>
                        </div>
                     </div>
                  </div>
                  <div class="sensor-card">
                     <div class="sensor-icon humidity">üíß</div>
                     <div class="sensor-data">
                        <h3>Humidity</h3>
                        <div>
                           <span class="sensor-value" id="humidityValue">--</span>
                           <span class="sensor-unit">%</span>
                        </div>
                     </div>
                  </div>
               </div>
            </div>

            <div class="status-bar fade-in">
               <div class="status-grid">
                  <div class="status-item">
                     <div class="status-icon connected">üì∂</div>
                     <div class="status-text">
                        <h3>Connection</h3>
                        <p id="brokerStatus">Connecting...</p>
                     </div>
                  </div>
                  <div class="status-item">
                     <div class="status-icon info">‚ö°</div>
                     <div class="status-text">
                        <h3>Active Relays</h3>
                        <p id="activeCount">0 of 4</p>
                     </div>
                  </div>
                  <div class="status-item">
                     <div class="status-icon info">‚è∞</div>
                     <div class="status-text">
                        <h3>Active Timers</h3>
                        <p id="timerCount">0 running</p>
                     </div>
                  </div>
                  <div class="status-item">
                     <div class="status-icon sensor" id="sensorStatusIcon">üå°Ô∏è</div>
                     <div class="status-text">
                        <h3>Sensor Status</h3>
                        <p id="sensorStatus">Reading...</p>
                     </div>
                  </div>
                  <div class="status-item">
                     <div class="status-icon info">üïí</div>
                     <div class="status-text">
                        <h3>Last Update</h3>
                        <p id="lastUpdate">Just now</p>
                     </div>
                  </div>
               </div>
            </div>

            <div class="controls-grid fade-in">
               <!-- Relay 1 -->
               <div class="switch-card" id="switch1">
                  <div class="switch-header">
                     <div class="switch-info">
                        <h3>Living Room Lights</h3>
                        <p>Relay 1</p>
                     </div>
                     <div class="switch-toggle" onclick="toggleSwitch(1)"></div>
                  </div>
                  <div class="switch-status">
                     <div class="status-dot"></div>
                     <span>OFF</span>
                  </div>
                  <div class="timer-display hidden" id="timer-display-1">Timer: 00:00:00</div>
                  <div class="timer-controls">
                     <div class="timer-input-group">
                        <div style="text-align: center">
                           <input
                              type="number"
                              class="timer-input"
                              id="hours-1"
                              placeholder="0"
                              min="0"
                              max="23"
                           />
                           <div class="timer-unit">Hours</div>
                        </div>
                        <div style="text-align: center">
                           <input
                              type="number"
                              class="timer-input"
                              id="minutes-1"
                              placeholder="0"
                              min="0"
                              max="59"
                           />
                           <div class="timer-unit">Minutes</div>
                        </div>
                        <div style="text-align: center">
                           <input
                              type="number"
                              class="timer-input"
                              id="seconds-1"
                              placeholder="0"
                              min="0"
                              max="59"
                           />
                           <div class="timer-unit">Seconds</div>
                        </div>
                     </div>
                     <div class="timer-buttons">
                        <button
                           class="btn btn-timer"
                           onclick="setTimer(1)"
                           style="flex: 1; font-size: 0.75rem"
                        >
                           ‚è±Ô∏è Set Timer
                        </button>
                        <button
                           class="btn btn-danger hidden"
                           onclick="cancelTimer(1)"
                           style="flex: 1; font-size: 0.75rem"
                           id="cancel-btn-1"
                        >
                           ‚ùå Cancel
                        </button>
                     </div>
                  </div>
               </div>

               <!-- Relay 2 -->
               <div class="switch-card" id="switch2">
                  <div class="switch-header">
                     <div class="switch-info">
                        <h3>Bedroom Fan</h3>
                        <p>Relay 2</p>
                     </div>
                     <div class="switch-toggle" onclick="toggleSwitch(2)"></div>
                  </div>
                  <div class="switch-status">
                     <div class="status-dot"></div>
                     <span>OFF</span>
                  </div>
                  <div class="timer-display hidden" id="timer-display-2">Timer: 00:00:00</div>
                  <div class="timer-controls">
                     <div class="timer-input-group">
                        <div style="text-align: center">
                           <input
                              type="number"
                              class="timer-input"
                              id="hours-2"
                              placeholder="0"
                              min="0"
                              max="23"
                           />
                           <div class="timer-unit">Hours</div>
                        </div>
                        <div style="text-align: center">
                           <input
                              type="number"
                              class="timer-input"
                              id="minutes-2"
                              placeholder="0"
                              min="0"
                              max="59"
                           />
                           <div class="timer-unit">Minutes</div>
                        </div>
                        <div style="text-align: center">
                           <input
                              type="number"
                              class="timer-input"
                              id="seconds-2"
                              placeholder="0"
                              min="0"
                              max="59"
                           />
                           <div class="timer-unit">Seconds</div>
                        </div>
                     </div>
                     <div class="timer-buttons">
                        <button
                           class="btn btn-timer"
                           onclick="setTimer(2)"
                           style="flex: 1; font-size: 0.75rem"
                        >
                           ‚è±Ô∏è Set Timer
                        </button>
                        <button
                           class="btn btn-danger hidden"
                           onclick="cancelTimer(2)"
                           style="flex: 1; font-size: 0.75rem"
                           id="cancel-btn-2"
                        >
                           ‚ùå Cancel
                        </button>
                     </div>
                  </div>
               </div>

               <!-- Relay 3 -->
               <div class="switch-card" id="switch3">
                  <div class="switch-header">
                     <div class="switch-info">
                        <h3>Kitchen Appliances</h3>
                        <p>Relay 3</p>
                     </div>
                     <div class="switch-toggle" onclick="toggleSwitch(3)"></div>
                  </div>
                  <div class="switch-status">
                     <div class="status-dot"></div>
                     <span>OFF</span>
                  </div>
                  <div class="timer-display hidden" id="timer-display-3">Timer: 00:00:00</div>
                  <div class="timer-controls">
                     <div class="timer-input-group">
                        <div style="text-align: center">
                           <input
                              type="number"
                              class="timer-input"
                              id="hours-3"
                              placeholder="0"
                              min="0"
                              max="23"
                           />
                           <div class="timer-unit">Hours</div>
                        </div>
                        <div style="text-align: center">
                           <input
                              type="number"
                              class="timer-input"
                              id="minutes-3"
                              placeholder="0"
                              min="0"
                              max="59"
                           />
                           <div class="timer-unit">Minutes</div>
                        </div>
                        <div style="text-align: center">
                           <input
                              type="number"
                              class="timer-input"
                              id="seconds-3"
                              placeholder="0"
                              min="0"
                              max="59"
                           />
                           <div class="timer-unit">Seconds</div>
                        </div>
                     </div>
                     <div class="timer-buttons">
                        <button
                           class="btn btn-timer"
                           onclick="setTimer(3)"
                           style="flex: 1; font-size: 0.75rem"
                        >
                           ‚è±Ô∏è Set Timer
                        </button>
                        <button
                           class="btn btn-danger hidden"
                           onclick="cancelTimer(3)"
                           style="flex: 1; font-size: 0.75rem"
                           id="cancel-btn-3"
                        >
                           ‚ùå Cancel
                        </button>
                     </div>
                  </div>
               </div>

               <!-- Relay 4 -->
               <div class="switch-card" id="switch4">
                  <div class="switch-header">
                     <div class="switch-info">
                        <h3>Garden Lights</h3>
                        <p>Relay 4</p>
                     </div>
                     <div class="switch-toggle" onclick="toggleSwitch(4)"></div>
                  </div>
                  <div class="switch-status">
                     <div class="status-dot"></div>
                     <span>OFF</span>
                  </div>
                  <div class="timer-display hidden" id="timer-display-4">Timer: 00:00:00</div>
                  <div class="timer-controls">
                     <div class="timer-input-group">
                        <div style="text-align: center">
                           <input
                              type="number"
                              class="timer-input"
                              id="hours-4"
                              placeholder="0"
                              min="0"
                              max="23"
                           />
                           <div class="timer-unit">Hours</div>
                        </div>
                        <div style="text-align: center">
                           <input
                              type="number"
                              class="timer-input"
                              id="minutes-4"
                              placeholder="0"
                              min="0"
                              max="59"
                           />
                           <div class="timer-unit">Minutes</div>
                        </div>
                        <div style="text-align: center">
                           <input
                              type="number"
                              class="timer-input"
                              id="seconds-4"
                              placeholder="0"
                              min="0"
                              max="59"
                           />
                           <div class="timer-unit">Seconds</div>
                        </div>
                     </div>
                     <div class="timer-buttons">
                        <button
                           class="btn btn-timer"
                           onclick="setTimer(4)"
                           style="flex: 1; font-size: 0.75rem"
                        >
                           ‚è±Ô∏è Set Timer
                        </button>
                        <button
                           class="btn btn-danger hidden"
                           onclick="cancelTimer(4)"
                           style="flex: 1; font-size: 0.75rem"
                           id="cancel-btn-4"
                        >
                           ‚ùå Cancel
                        </button>
                     </div>
                  </div>
               </div>
            </div>

            <div class="master-controls fade-in">
               <h2>Master Controls</h2>
               <div class="master-buttons">
                  <button class="master-btn on" id="allOnBtn" onclick="allSwitchesOn()">
                     ‚ö° Turn All ON
                  </button>
                  <button class="master-btn off" id="allOffBtn" onclick="allSwitchesOff()">
                     üîå Turn All OFF
                  </button>
                  <button
                     class="master-btn timer"
                     id="cancelAllTimersBtn"
                     onclick="cancelAllTimers()"
                  >
                     ‚è∞ Cancel All Timers
                  </button>
               </div>
            </div>
         </div>
      </div>

      <!-- Change Password Page -->
      <div id="changePasswordPage" class="hidden">
         <div class="change-password-container">
            <div class="change-password-box fade-in">
               <div class="login-header">
                  <h1>‚öôÔ∏è Change Credentials</h1>
                  <p>Update your username and password</p>
               </div>
               <form id="changePasswordForm">
                  <div class="form-group">
                     <label class="form-label">Current Password</label>
                     <input
                        type="password"
                        id="currentPassword"
                        class="form-input"
                        placeholder="Enter current password"
                        required
                     />
                  </div>
                  <div class="form-group">
                     <label class="form-label">New Username</label>
                     <input
                        type="text"
                        id="newUsername"
                        class="form-input"
                        placeholder="Enter new username"
                        required
                     />
                  </div>
                  <div class="form-group">
                     <label class="form-label">New Password</label>
                     <input
                        type="password"
                        id="newPassword"
                        class="form-input"
                        placeholder="Enter new password"
                        required
                     />
                  </div>
                  <div class="form-group">
                     <label class="form-label">Confirm New Password</label>
                     <input
                        type="password"
                        id="confirmPassword"
                        class="form-input"
                        placeholder="Confirm new password"
                        required
                     />
                  </div>
                  <div style="display: flex; gap: 1rem">
                     <button
                        type="button"
                        class="btn btn-secondary"
                        onclick="showMainPage()"
                        style="flex: 1; justify-content: center"
                     >
                        ‚Üê Back
                     </button>
                     <button
                        type="submit"
                        class="btn btn-primary"
                        id="changePasswordBtn"
                        style="flex: 1; justify-content: center"
                     >
                        üíæ Update
                     </button>
                  </div>
                  <div id="changePasswordError" class="error-message"></div>
                  <div id="changePasswordSuccess" class="success-message"></div>
                  <div id="changePasswordWarning" class="warning-message"></div>
               </form>
            </div>
         </div>
      </div>

      <script src="index.js"></script>
   </body>
</html>
